# 📘 議事録インタビューAI - Smart Minutes

音声入力で簡単に議事録を作成できるWebアプリケーションです。

## 🎯 このアプリでできること

1. **音声で議事録を入力** - マイクに向かって話すだけで自動的に文字起こし
2. **キーボードでも編集可能** - 音声とキーボード入力を組み合わせて使える
3. **4つのモードから選択** - 電力用、保健用、一般用、質問なしモード
4. **AIが自動整形** - Google Gemini APIが議事録として整った文章に変換
5. **Word文書を自動生成** - ボタン1つで議事録のWord文書をダウンロード

## 💡 使い方

### ステップ1: トップページで用途を選ぶ
- ⚡ **電力用** - 電力関係の会議向け
- 🏥 **保健用** - 保健・医療関係の会議向け
- 💼 **一般用** - 一般的なビジネス会議向け
- ✍️ **質問なしモード** - 自由に内容を入力したい場合

### ステップ2: 質問に答える（質問ありモード）
1. 画面に質問が表示されます
2. 録音ボタンを押して話す（クリックで開始・もう一度押すと停止）
3. もう一度押すと録音終了
4. テキストエリアで編集も可能
5. 「次へ」ボタンで次の質問へ

### ステップ3: Word文書を生成
1. すべての質問に答えたら「Word生成」ボタンをクリック
2. AIが議事録形式に整形
3. Word文書が自動ダウンロード

## 🚀 開発者向けセットアップ

### 必要なもの
- Python 3.8以上
- Google Gemini APIキー（無料で取得可能）
- Webブラウザ（Chrome、Edge、Safari推奨）

### 1. リポジトリをクローン

```bash
git clone https://github.com/hpartner-ai/minutes-automation.git
cd minutes-automation
```

### 2. 仮想環境を作成

**Windows (PowerShell)**
```powershell
python -m venv .venv
.venv\Scripts\Activate.ps1
```

**Mac/Linux**
```bash
python -m venv .venv
source .venv/bin/activate
```

### 3. 依存パッケージをインストール

```bash
pip install -r requirements.txt
```

### 4. 環境変数を設定

`.env`ファイルを作成して、Gemini APIキーを設定：

```bash
GEMINI_API_KEY=your_api_key_here
```

**Gemini APIキーの取得方法:**
1. https://aistudio.google.com/app/apikey にアクセス
2. Googleアカウントでログイン
3. 「Create API Key」をクリック
4. 生成されたキーをコピーして`.env`に貼り付け

### 5. サーバーを起動

```bash
uvicorn main:app --host 0.0.0.0 --port 8001
```

または

```bash
python main.py
```

### 6. ブラウザでアクセス

```
http://localhost:8001
```

## 🏗️ システム構成

### 現在の構成（Web Speech API版）

**フロントエンド（ブラウザ側）**
- **HTML/CSS** - きれいなUI（Zen Maru Gothicフォント使用）
- **JavaScript** - Web Speech APIで音声認識（ブラウザ内処理）
- **録音機能** - ボタンを押して録音（クリックでトグル、もう一度押すと停止）

**バックエンド（サーバー側）**
- **FastAPI** - Pythonの高速Webフレームワーク
- **Google Gemini API** - 議事録の整形・要約
- **python-docx** - Word文書の生成

**データの流れ**
```
ユーザーの音声
  ↓
ブラウザで文字起こし（Web Speech API - 無料）
  ↓
テキストのみサーバーに送信（FastAPI）
  ↓
AIで整形（Google Gemini API）
  ↓
Word文書生成（python-docx）
  ↓
ダウンロード
```

### Whisper API版との比較

| 項目 | 現在（Web Speech API） | Whisper API導入時 |
|------|----------------------|------------------|
| **音声認識** | ブラウザ（無料） | OpenAI Whisper API（有料） |
| **コスト** | $0 | $0.006/分 ≒ $0.03/回 |
| **精度** | 良好（日本語対応） | 非常に高精度 |
| **対応言語** | 主要言語のみ | 99言語対応 |
| **オフライン** | 不可 | 不可 |
| **ブラウザ依存** | あり（Chrome推奨） | なし |
| **プライバシー** | 音声はブラウザ内処理 | 音声ファイルをOpenAIに送信 |
| **実装の複雑さ** | シンプル | やや複雑（音声ファイル処理） |
| **長時間録音** | 制限あり（数分） | 25MB / 20分まで |

**Whisper API版のデータの流れ**
```
ユーザーの音声
  ↓
ブラウザで録音
  ↓
音声ファイル（MP3/WAV）としてサーバーにアップロード
  ↓
OpenAI Whisper APIで文字起こし（$0.006/分）
  ↓
テキストをGemini APIで整形
  ↓
Word文書生成（python-docx）
  ↓
ダウンロード
```

## 📁 プロジェクト構造

```
minutes-automation/
├── main.py                          # アプリケーションのエントリーポイント
├── requirements.txt                 # Pythonパッケージ一覧
├── .env                            # 環境変数（APIキー）
├── render.yaml                     # Renderデプロイ設定
│
├── app/                            # アプリケーション本体
│   ├── config.py                   # 設定読み込み
│   ├── domain/                     # ビジネスロジック
│   │   ├── interview.py           # インタビュー処理
│   │   └── summary.py             # 要約処理
│   ├── services/                   # 外部サービス連携
│   │   ├── gemini_service.py      # Gemini API連携
│   │   ├── stt_service.py         # 音声認識
│   │   └── tts_service.py         # 音声合成
│   └── ui/                         # フロントエンド
│       ├── templates/              # HTMLファイル
│       │   ├── top.html           # トップページ
│       │   ├── index.html         # 質問モードページ
│       │   └── bulk.html          # 自由入力ページ
│       └── static/                 # CSS/JavaScript
│           ├── style.css          # スタイルシート
│           ├── app.js             # 質問モード用JS
│           └── bulk.js            # 自由入力用JS
│
├── config/                         # 質問設定
│   ├── config_denryoku.json       # 電力用の質問
│   ├── config_hoken.json          # 保健用の質問
│   ├── config_ippan.json          # 一般用の質問
│   └── config_free.json           # 自由入力用設定
│
└── .gitignore                      # Gitで管理しないファイル
```

## ⚙️ 設定ファイルについて

### config_*.json の構造

各設定ファイルには以下の情報が含まれています：

```json
{
  "questions": [
    {
      "id": 1,
      "category": "基本情報",
      "text": "会社名を教えてください"
    }
  ],
  "summary_prompt": "議事録として整形するためのAIへの指示"
}
```

### 質問のカスタマイズ方法

1. `config/config_ippan.json`などを開く
2. `questions`配列に質問を追加・編集
3. サーバーを再起動

例：
```json
{
  "id": 11,
  "category": "追加項目",
  "text": "次回の予定はありますか？"
}
```

---

## 💰 コスト比較とプラン選定

### 音声認識方式の選択

#### 📊 1議事録あたりのコスト比較

**「1回」= 会議1回分の議事録作成（質問4つに回答して1つのWord文書生成）**

| 方式 | 音声認識コスト | Gemini API | 合計 | 想定時間 |
|------|--------------|-----------|------|---------|
| **Web Speech API（現在）** | $0 | $0.0001 | **$0.0001** | 何分でも$0 |
| **Whisper API** | $0.006/分 | $0.0001 | **$0.03** | **5分間の会議** |
| **Whisper API** | $0.006/分 | $0.0001 | **$0.06** | **10分間の会議** |
| **Whisper API** | $0.006/分 | $0.0001 | **$0.12** | **20分間の会議** |
| **Whisper API** | $0.006/分 | $0.0001 | **$0.36** | **60分間の会議** |

**時間別コスト:**
- Web Speech API: **時間に関係なく$0（無料）**
- Whisper API: **$0.006/分 = $0.36/時間**

💡 **Web Speech APIの方が圧倒的にコスト効率が良い（無限倍！）**

#### 📈 月間利用回数別のコスト差（1会議5分想定）

| 月間議事録数 | 合計会議時間 | Web Speech API | Whisper API | コスト差 |
|------------|------------|----------------|------------|---------|
| 50回 | 4.2時間 | **$0.01** | $1.51 | +$1.50 |
| 200回 | 16.7時間 | **$0.02** | $6.02 | +$6.00 |
| 500回 | 41.7時間 | **$0.06** | $15.06 | +$15.00 |
| 1,000回 | 83.3時間 | **$0.11** | $30.11 | +$30.00 |
| 5,000回 | 416.7時間 | **$0.56** | $150.56 | +$150.00 |

**💡 ポイント:**
- Web Speech APIは**会議時間に関係なく無料**
- Whisper APIは**1時間の会議で$0.36のコスト**
- 月間100時間の会議 → Whisper APIだと$36の追加コスト

### Whisper APIを検討すべきケース

以下の場合のみWhisper API導入を推奨：

✅ **精度が最重要** - 医療・法務など誤字が許されない
✅ **多言語対応が必須** - 英語・中国語など日本語以外の議事録
✅ **長時間録音** - 1時間以上の会議を1ファイルで処理
✅ **方言・専門用語が多い** - Web Speech APIで認識精度が低い

### 推奨プラン

#### 🎯 スタートアップ・テスト環境向け

```
✅ 音声認識: Web Speech API（無料）
✅ Gemini API: 無料枠（月間800回まで）
✅ Render: Free

💰 合計: $0/月
📊 対応: 月間800回の議事録生成
👥 適合: 社内テスト、5人以下
⚠️ 注意: 15分アクセスなしで自動スリープ（起動に数秒）
```

#### 🏢 実運用向け（小〜中規模）

```
✅ 音声認識: Web Speech API（無料）
✅ Gemini API: 無料枠→有料移行
✅ Render: Starter ($7/月)

💰 合計: $7〜$8/月
📊 対応: 月間800〜1,500回
👥 適合: 5〜100人規模
💡 理由: 24時間稼働でスリープなし（処理負荷的にはFreeで十分）
```

#### 🏭 大規模・高可用性要求向け

```
✅ 音声認識: Web Speech API（無料）
✅ Gemini API: 有料プラン
✅ Render: Standard ($25/月)

💰 合計: $25〜$26/月
📊 対応: 月間数千回〜無制限
👥 適合: 100人以上、高可用性必須
💡 理由: より高いCPU・RAMで同時アクセス対応
```

#### 🔬 高精度・多言語対応向け

```
⚠️ 音声認識: Whisper API（$0.03/回）
✅ Gemini API: 有料プラン
✅ Render: Starter ($7/月)

💰 合計: $37〜$67/月（月間1,000回想定）
📊 対応: 無制限
👥 適合: 医療・法務など高精度要求
💡 注意: 音声認識のコストが支配的（サーバースペックは不要）
```

---

## 📊 詳細プラン比較表

### Gemini API（議事録整形）

| プラン | 料金 | 制限 | 適合規模 |
|--------|------|------|---------|
| **無料枠** | $0 | 100万トークン/月<br>15リクエスト/分<br>1,500リクエスト/日 | **月間800回まで** |
| **有料** | 入力: $0.075 / 100万トークン<br>出力: $0.30 / 100万トークン | なし | 月間800回以上 |

**コスト例（有料時）:**
- 1,000回/月: $0.11
- 5,000回/月: $0.56
- 10,000回/月: $1.13

### Whisper API（音声認識）※導入時のみ
（時間ベース）:**
- 月間10時間: $3.60
- 月間50時間: $18.00
- 月間100時間: $36.00
- 月間500時間: $180.00

**コスト例（会議回数ベース・5分/会議想定）:**
- 1,000回/月（83時間）: $30/月
- 5,000回/月（417時間）: $15---|---------|
| **標準** | $0.006 / 分 | 25MB / ファイル<br>最大20分 | すべて |

**コスト例:**
- 5分音声 × 1,000回: $30/月
- 10分音声 × 1,000回: $60/月

### Render（ホスティング）

| プラン | 料金 | RAM | CPU | 稼働時間 | 適合規模 | 選択理由 |
|--------|------|-----|-----|---------|---------|---------|
| **Free** | $0 | 512MB | 0.1 | 750h/月<br>（自動スリープ） | テスト用 | **処理負荷的には十分**<br>スリープが許容できるなら |
| **Starter** | $7/月 | 512MB | 0.5 | 24時間 | **5〜100人** | **24時間稼働が必要なら**<br>スペックはFreeと大差なし |
| **Standard** | $25/月 | 2GB | 1.0 | 24時間 | **100〜300人** | 同時アクセス10〜20人程度<br>月間数千回の利用 |
| **Pro** | $85/月 | 4GB | 2.0 | 24時間<br>高可用性 | **300〜1,000人<br>同時50人以上** | 大企業・全社展開<br>ダウンタイム許容不可<br>**99%以上のケースで不要** |

**💡 重要:** このアプリはサーバー側の処理が超軽量（音声認識はブラウザ、AIはGemini API）。
- **Free** で処理能力は十分（テスト・小規模）
- **Starter** は24時間稼働のためだけ（100人規模でも十分）
- **Standard** は同時アクセス10〜20人、月間数千回で検討
- **Pro** は同時50人以上・全社1,000人規模のみ（ほぼ不要）

---

## 🎯 最終推奨

### 現行システム（Web Speech API）で十分なケース: 90%以上

- 日本語のみの議事録
- Chrome/Edge/Safariが使用可能
- コストを最小限に抑えたい
- 月間数百〜数千回の利用

**→ 追加コストなし、Renderのホスティング代のみ**

### Whisper API導入が必要なケース: 10%未満

- 多言語対応が必須
- 医療・法務など超高精度が必要
- 方言や専門用語が非常に多い
- 予算に余裕がある

**→ 月間$30〜$150の追加コスト発生**
### パターン1: まずは完全無料で試す

## **シーケンス図（主要フロー）**

以下は主要なAPIフローを表すシーケンス図です：

```
+---------------------------------------------------------------+
| シーケンス図: /api/stt と /api/docx の主要フロー            |
+---------------------------------------------------------------+

ユーザー        ブラウザ(UI)         サーバ(FastAPI)      STT      Gemini       Docx
  |                |                     |               |        |           |
  | 録音/入力       |                     |               |        |           |
  |--------------->|                     |               |        |           |
  |                | POST /api/stt       |               |        |           |
  |                |-------------------->|               |        |           |
  |                |                     | transcribe()  |        |           |
  |                |                     |-------------->|        |           |
  |                |                     |               | transcript --> |
  |                |                     |<--------------|        |           |
  |                |                     | summarize(q,t)---------------|           |
  |                |                     |----------------------------->|           |
  |                |                     |               | formatted_summary |           |
  |                |<--------------------|               |        |           |
  | 要約＋次の質問  |                     |               |        |           |
  |<---------------|                     |               |        |           |

（/api/docx の流れ）
  ユーザー -> ブラウザ: 全回答データ送信
  ブラウザ -> サーバ: POST /api/docx (answers, interview_type)
  サーバ -> Gemini: summarize(custom_prompt + all_QA)
  Gemini -> サーバ: formatted_content
  サーバ -> Docx: generate_document(formatted_content)
  Docx -> サーバ: docx_file_path
  サーバ -> ブラウザ: FileResponse (docx をダウンロード)

図の読み方: 左から右へ時間進行。矢印はリクエスト／レスポンスの方向を示します。
```

（注）図はMermaid形式です。GitHubや多くのMarkdownビューアでレンダリングされます。

```
💡 テスト・小規模運用向け
音声認識: Web Speech API（無料）
Gemini API: 無料枠
Render: Free

合計: $0/月

→ 月間800回まで完全無料
→ 15分未使用で自動スリープ（起動に数秒かかる）
→ 社内5人程度なら十分
```

### パターン2: 24時間稼働させる

```
💡 実運用向け（最もコスパが良い）
音声認識: Web Speech API（無料）
Gemini API: 無料枠
Render: Starter ($7/月)

合計: $7/月

→ 月間800回の議事録生成に対応
→ 50〜100人規模でも問題なし
→ スリープなしで即座にアクセス可能
```

### 💡 重要なポイント

**サーバースペックは上げなくてOK！**
- 音声認識はブラウザで処理（サーバー負荷ゼロ）
- サーバーはテキスト受信 → Gemini API → Word生成のみ
- 処理が超軽量なので、**Freeでも性能的には十分**
- StarterとFreeの違いは「24時間稼働かどうか」だけ

**アップグレードが必要な場合:**
- 同時アクセスが100人を超える → Standard検討
- それ以外はStarterで十分


→ 20〜50人規模のチームで十分
→ 必要に応じてRenderのみアップグレード
```

利用状況を見て、必要に応じてRenderをStandard ($25/月)にアップグレード。音声認識はWeb Speech APIのままで十分です！
